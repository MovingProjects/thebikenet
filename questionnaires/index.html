<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>theBIKEnet ‚Äì Questionari</title>

    <!-- ‚úÖ Primary metadata (puoi adattare se vuoi mantenerla come Privacy) -->
    <meta name="description"
      content="Elenco dei questionari di theBIKEnet, caricati automaticamente dal repository GitHub MovingProjects/thebikenet.">
    <meta name="author" content="Moving Projects Srl">
    <meta name="robots" content="index, follow">
    <meta name="theme-color" content="#0C9091">

    <meta name="publisher" content="Moving Projects Srl" />
    <meta name="organization" content="https://movprojects.com/" />

    <!-- ‚úÖ Open Graph / Facebook -->
    <meta property="og:title" content="theBIKEnet ‚Äì Questionari" />
    <meta property="og:description"
      content="Pagina che elenca i questionari di theBIKEnet dal repository GitHub MovingProjects/thebikenet." />
    <meta property="og:image"
      content="https://movingprojects.github.io/thebikenet/docs/assets/theBIKEnet_logo.png" />
    <meta property="og:url"
      content="https://movingprojects.github.io/thebikenet/docs/questionnaires.html" />
    <meta property="og:type" content="website" />
    <meta property="og:locale" content="en_GB" />

    <!-- ‚úÖ Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="theBIKEnet ‚Äì Questionari" />
    <meta name="twitter:description"
      content="Elenco automatico dei questionari di theBIKEnet dal repository GitHub MovingProjects/thebikenet." />
    <meta name="twitter:image"
      content="https://movingprojects.github.io/thebikenet/docs/assets/theBIKEnet_logo.png" />

    <!-- ‚úÖ Canonical URL -->
    <link rel="canonical"
      href="https://movingprojects.github.io/thebikenet/docs/questionnaires.html" />

    <!-- ‚úÖ Favicons -->
    <link rel="icon"
      href="https://movingprojects.github.io/thebikenet/docs/assets/theBIKEnet_logo.png"
      type="image/png" />
    <link rel="apple-touch-icon"
      href="https://movingprojects.github.io/thebikenet/docs/assets/theBIKEnet_logo.png" />

    <!-- ‚úÖ External theBIKEnet style -->
    <link rel="stylesheet"
      href="https://movingprojects.github.io/thebikenet/docs/assets/theBIKEnet-style.css" />

    <style>
      /* ‚úÖ Accessibility: visible focus outlines + skip link */
      :focus-visible {
        outline: 3px solid #F2AD2B;
        outline-offset: 3px;
      }

      .skip-link {
        position: absolute;
        top: 0;
        left: 0;
        background: #0C9091;
        color: #fff;
        padding: 0.6rem 1rem;
        border-radius: 0 0 6px 0;
        transform: translateY(-120%);
        transition: transform 0.3s ease;
        z-index: 100;
      }

      .skip-link:focus {
        transform: translateY(0);
      }

      /* ‚úÖ Stili per la lista dei questionari (da index.html) */
      #q-list a {
        color: #0C9091;
        font-weight: 600;
      }

      #q-list li {
        margin: 0.4rem 0;
      }
    </style>

    <!-- ‚úÖ Script lingua (dal template privacy) -->
    <script>
  function initLangToggle() {
    const btn = document.getElementById("toggleLang");
    const main = document.querySelector("main");
    const lang = (navigator.language || navigator.userLanguage || "en").toLowerCase();
    window.currentLang = lang.startsWith("it") ? "it" : "en";

    function showLang(l) {
      document.querySelectorAll("[data-lang]").forEach(el => {
        el.style.display = el.getAttribute("data-lang") === l ? "block" : "none";
      });
      if (main) main.setAttribute("lang", l);
      window.currentLang = l;

      if (btn) {
        btn.setAttribute(
          "aria-label",
          `Change language. Current: ${l === "en" ? "English" : "Italiano"}`
        );
        btn.textContent = l.toUpperCase();
      }
    }

    // rendo la funzione disponibile anche ad altri script
    window.setLang = showLang;

    showLang(window.currentLang);

    if (btn) {
      btn.addEventListener("click", () =>
        showLang(window.currentLang === "en" ? "it" : "en")
      );
    }
  }

  document.addEventListener("DOMContentLoaded", initLangToggle);
</script>

    <!-- ‚úÖ Script per caricare la lista dei questionari da GitHub (da index.html) -->
    <script>
  const OWNER = "MovingProjects";
  const REPO = "thebikenet";
  const PATH = "questionnaires";

  // üîó Base URL dell'app che espone i questionari da compilare
  // Risultato finale: `${FORM_BASE_URL}/${projectId}/${questId}`
  const FORM_BASE_URL = "https://example.com/project"; // TODO: sostituisci col tuo dominio

  const INDEX_URL = `https://raw.githubusercontent.com/MovingProjects/thebikenet/main/questionnaires/surveys/index.json`;

  async function fetchIndex() {
    const res = await fetch(INDEX_URL);
    if (!res.ok) throw new Error("Cannot load questionnaires/index.json");
    return res.json();
  }

  async function fetchQuestionnaire(filename) {
    const url = `https://raw.githubusercontent.com/MovingProjects/thebikenet/main/questionnaires/surveys/${filename}`;
    const res = await fetch(url);
    if (!res.ok) throw new Error(`Cannot load ${filename}`);
    return res.json();
  }

  async function renderList() {
    const grid = document.getElementById("q-list");
    if (!grid) return;

    grid.innerHTML = `
      <div class="q-placeholder"></div>
      <div class="q-placeholder"></div>
      <div class="q-placeholder"></div>
    `;

    try {
      const data = await fetchIndex();
      const list = data.questionnaires || [];
      const projectId =
        data.destination &&
        data.destination.firestore &&
        data.destination.firestore.projectId
          ? data.destination.firestore.projectId
          : null;

      grid.innerHTML = "";

      for (const filename of list) {
        const baseName = filename.replace(".json", "");

          const viewLink = `https://github.com/MovingProjects/thebikenet/blob/main/questionnaires/surveys/${filename}`;
        const questionnaireUrl =
          projectId && FORM_BASE_URL
            ? `${FORM_BASE_URL}/${projectId}/${baseName}`
            : null;

        let titleEn = baseName;
        let titleIt = baseName;
        let descEn = "";
        let descIt = "";

        try {
          const qJson = await fetchQuestionnaire(filename);
          const qDef = qJson.questionnaire || {};
          const sections = qDef.sections || [];
          const languages = qJson.languages || {};
          const itMap = languages.it || {};

          if (qDef.name) {
            titleEn = qDef.name;
          }

          const itTitleKey = qDef.name ? "#" + qDef.name : null;
          if (itTitleKey && itMap[itTitleKey]) {
            titleIt = itMap[itTitleKey];
          } else {
            titleIt = titleEn;
          }

          if (sections.length > 0) {
            descEn =
              sections[0].description ||
              sections[0].title ||
              "Structured questionnaire about cycling and urban mobility.";
          } else {
            descEn =
              qDef.name ||
              "Structured questionnaire about cycling and urban mobility.";
          }

          const itDescKey = "#" + descEn;
          if (itMap[itDescKey]) {
            descIt = itMap[itDescKey];
          } else {
            descIt = descEn;
          }
        } catch (err) {
          console.warn(`Error parsing questionnaire ${filename}`, err);
          titleEn = baseName;
          titleIt = baseName;
          descEn = "Structured questionnaire definition.";
          descIt = "Definizione strutturata del questionario.";
        }

        const card = document.createElement("div");
        card.className = "q-card";

        card.innerHTML = `
          <div>
            <h3>
              <span data-lang="it">${titleIt}</span>
              <span data-lang="en">${titleEn}</span>
            </h3>

            <div class="q-description">
             <button type="button" class="q-toggle" aria-expanded="false">
  <span class="q-toggle-icon">‚ñº</span>
  <span data-lang="it">Descrizione</span>
  <span data-lang="en">Description</span>
</button>

              <div class="q-desc-body" hidden>
                <p data-lang="it">${descIt}</p>
                <p data-lang="en">${descEn}</p>
              </div>
            </div>
          </div>

          <div class="q-card-links">
            <a href="${viewLink}" target="_blank" rel="noopener">
              <span data-lang="it">üìÑ Vedi schema JSON</span>
              <span data-lang="en">üìÑ View JSON schema</span>
            </a>

            ${
              questionnaireUrl
                ? `
            <a href="${questionnaireUrl}" target="_blank" rel="noopener">
              <span data-lang="it">üìù Rispondi al questionario</span>
              <span data-lang="en">üìù Fill in the questionnaire</span>
            </a>`
                : ""
            }
          </div>
        `;

        // toggle descrizione
        const toggleBtn = card.querySelector(".q-toggle");
        const descBody = card.querySelector(".q-desc-body");
        if (toggleBtn && descBody) {
          toggleBtn.addEventListener("click", () => {
            const isExpanded = toggleBtn.getAttribute("aria-expanded") === "true";
            toggleBtn.setAttribute("aria-expanded", String(!isExpanded));
            descBody.hidden = isExpanded;

            const labelIt = toggleBtn.querySelector('span[data-lang="it"]');
            const labelEn = toggleBtn.querySelector('span[data-lang="en"]');
           if (!isExpanded) {
  // ora si espande, quindi il testo diventa ‚ÄúNascondi / Hide‚Äù
  if (labelIt) labelIt.textContent = "Nascondi";
  if (labelEn) labelEn.textContent = "Hide";
} else {
  // ora si chiude
  if (labelIt) labelIt.textContent = "Descrizione";
  if (labelEn) labelEn.textContent = "Description";
}

          });
        }

        grid.appendChild(card);
      }

      if (!grid.hasChildNodes()) {
        grid.innerHTML = `
          <p data-lang="it">Nessun questionario trovato.</p>
          <p data-lang="en">No questionnaires found.</p>
        `;
      }

      // ‚úÖ riapplica il filtro lingua dopo aver creato le card
      if (window.setLang && window.currentLang) {
        window.setLang(window.currentLang);
      }
    } catch (err) {
      console.error(err);
      grid.innerHTML = `
        <p data-lang="it">Errore nel caricamento dei questionari.</p>
        <p data-lang="en">Error loading questionnaires.</p>
      `;
    }
  }

  document.addEventListener("DOMContentLoaded", renderList);
</script>

  </head>

  <body>
    <!-- ‚úÖ Skip link for keyboard/screen reader navigation -->
    <a href="#maincontent" class="skip-link">Skip to main content</a>

    <!-- ‚úÖ Header landmark (dal template privacy) -->
    <header role="banner">
      <div class="header-flex">
        <div class="brand">
          <img
            src="https://movingprojects.github.io/thebikenet/docs/assets/theBIKEnet_logo.png"
            alt="theBIKEnet project logo" />
          <div class="brand-title">
            <h1>theBIKEnet</h1>
            <p>Transferring Human Experience into BIKE Network Evaluation
              Technologies</p>
          </div>
        </div>
        <div class="right-header">
          <img
            src="https://movprojects.com/assets/images/moving_projects_logo.png"
            alt="Moving Projects organisation logo" class="mp-logo" />
          <button id="toggleLang" class="lang-toggle"
            aria-label="Change language">EN</button>
        </div>
      </div>
    </header>

    <!-- ‚úÖ Main landmark -->
    <main id="maincontent" tabindex="-1" role="main"
      aria-label="Questionnaires list" lang="en">

      <!-- ENGLISH VERSION -->
      <div data-lang="en" lang="en">
        <section>
          <h2>theBIKEnet questionnaires</h2>
          <p>
            Here you can explore the questionnaires used in theBIKEnet project
            to
            understand everyday cycling, micromobility and safety perceptions.
          </p>
          <p>
            Each card corresponds to one questionnaire. When a survey is open,
            you can
            use the <strong>‚ÄúFill in the questionnaire‚Äù</strong> button to
            participate.
            The link to the JSON schema is provided for transparency and for
            researchers who want to reuse the structure.
          </p>
        </section>
      </div>

      <!-- ITALIAN VERSION -->
      <div data-lang="it" lang="it">
        <section>
          <h2>I questionari di theBIKEnet</h2>
          <p>
            In questa pagina puoi esplorare i questionari utilizzati nel
            progetto
            theBIKEnet per capire come ci si muove in bici e in micromobilit√†
            e come viene percepita la sicurezza.
          </p>
          <p>
            Ogni scheda corrisponde a un questionario. Quando una rilevazione √®
            attiva puoi partecipare cliccando su <strong>‚ÄúRispondi al
              questionario‚Äù</strong>.
            Il link allo schema JSON √® pensato per trasparenza e per chi vuole
            riutilizzare la struttura a fini di ricerca.
          </p>
        </section>

      </div>

      <!-- Sezione comune con la lista (non dipende dalla lingua) -->
      <section aria-label="Elenco questionari GitHub">
        <div id="q-list" class="q-grid">
          <div class="q-placeholder"></div>
          <div class="q-placeholder"></div>
          <div class="q-placeholder"></div>
        </div>
      </section>
    </main>

    <!-- ‚úÖ Footer landmark (dal template privacy) -->
    <footer role="contentinfo">
      <div class="funding-logos">
        <img
          src="https://movprojects.com/assets/images/next-generation-eu-logo.png"
          alt="European Union NextGenerationEU logo" />
        <img src="https://movprojects.com/assets/images/mur-logo.png"
          alt="Ministero dell‚ÄôUniversit√† e della Ricerca logo" />
        <img src="https://movprojects.com/assets/images/italia-domani-logo.png"
          alt="Italia Domani PNRR logo" />
        <img src="https://movprojects.com/assets/images/sapienza-logo.png"
          alt="Sapienza Universit√† di Roma logo" />
      </div>

      <p>Project funded by the European Union ‚Äì NextGenerationEU under the
        <strong>National Recovery and Resilience Plan (PNRR)</strong>,
        CN4 ‚Äì Sustainable Mobility, Spoke 9 ‚Äì CUP B83C22002900007.</p>
      <p>
        ¬© 2025 <a href="https://movprojects.com/" target="_blank"
          rel="noopener">Moving Projects Srl</a> ¬∑
      </p>
    </footer>
  </body>
</html>
